# DWG_GUID_DISCIPLINE — контракт GUID и атрибутов блоков

Документ фиксирует правила работы с GUID и атрибутами блоков в DWG для интеграции с расчётным слоем (SLD-RTM).

## GUID — уникальность и неизменяемость

- **GUID** — единственный стабильный идентификатор блока, связывающий сущность в DWG с записью в БД/расчёте.
- **Уникальность:** В пределах одного чертежа каждый GUID должен встречаться не более одного раза среди блоков, участвующих в синхронизации.
- **Неизменяемость:** Скрипты и адаптеры **не должны изменять** значение атрибута GUID. GUID задаётся при создании блока и остаётся постоянным.

## Обязательные атрибуты

### GUID

- Имя атрибута в блоках: **`GUID`**.
- Тип: текстовая строка (обычно UUID).
- Назначение: сопоставление блока с записью в CSV/БД.
- Блоки без атрибута GUID или с пустым GUID не участвуют в импорте атрибутов.

### MODE (для секций)

- Имя атрибута: **`MODE`**.
- Используется только в блоках секций (sections).
- Значения: например `NORMAL`, `RESERVE` — задаются в mapping.
- CSV `attrs_sections.csv` содержит колонку MODE; импорт применяет значения по паре (GUID, MODE).

## Правила импорта атрибутов

Скрипт `import_attrs.lsp` (команда `IMPORT_ATTRS`):

1. **Обновляет только существующие атрибуты** — не создаёт новых.
2. **Не изменяет GUID** — атрибут GUID всегда остаётся без изменений.
3. **Не зависит от имени блока** — сопоставление только по GUID.
4. **Использует entget/entnext** — обновляет только те атрибуты, которые уже есть у блока.

## Источники данных

- `attrs_panel.csv` — атрибуты панелей (GUID, ATTR, VALUE).
- `attrs_circuits.csv` — атрибуты цепей (GUID, ATTR, VALUE).
- `attrs_sections.csv` — атрибуты секций по режиму (GUID, MODE, ATTR, VALUE).

При конфликте (один и тот же ATTR из нескольких источников) приоритет: sections > circuits > panel.
