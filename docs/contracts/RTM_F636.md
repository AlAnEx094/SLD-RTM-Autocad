# RTM_F636 — MVP-интерпретация формы Ф636-92 (один щит)

Этот документ фиксирует **минимальный набор вычислений** для MVP-0.1: расчёт нагрузок по РТМ 36.18.32.4-92
в терминах формы Ф636-92 **для одного щита**.

Цель — обеспечить воспроизводимый расчёт в SQLite (DB = истина) и экспорт результатов.

## Область применения (MVP-0.1)

- Рассчитывается **один щит** (panel).
- Ввод хранится отдельно от результатов расчёта.
- Коэффициент `Kr` берётся из SQLite по контракту `docs/contracts/KR_RESOLVER.md`.
- AutoCAD/DWG на этом шаге не реализуется (только будущие точки расширения; расчёт от DWG не зависит).

## Термины и обозначения (используемые в коде)

В MVP-0.1 мы используем следующие поля ввода для каждой строки формы (группы приёмников):

- `ne` — число приёмников/эквивалентное число \(n_e\) **в виде входного параметра** (в RTM может определяться методикой;
  в MVP допускаем, что оно задано пользователем/подготовлено заранее).
- `p_nom_kw` — номинальная активная мощность одного приёмника, кВт
- `ki` — коэффициент использования \(K_i\) (ввод)
- `cos_phi` — коэффициент мощности \(\cos\varphi\) (ввод)

Параметр щита:

- `u_ll_v` — линейное напряжение, В (по умолчанию 400 В для 3-фазной сети)

## Расчёт по строке (группа приёмников)

### 1) Установленная активная мощность

\[
P_{inst} = n_e \cdot P_{nom}
\]

где \(P_{nom}\) — `p_nom_kw`, \(P_{inst}\) — кВт.

### 2) Получение Kr

`Kr = get_kr(db_path, ne, ki)`

Поведение `get_kr()` строго задано контрактом:
`docs/contracts/KR_RESOLVER.md` (clamp по Ki, округление вверх по ne, интерполяция только по Ki).

### 3) Расчёт расчётной активной мощности (спрос)

В MVP-0.1 используем классическую форму:

\[
P_{demand} = P_{inst} \cdot K_i \cdot K_r
\]

### 4) Реактивная и полная мощность

Для заданного \(\cos\varphi\):

\[
\tan\varphi = \tan(\arccos(\cos\varphi))
\]
\[
Q_{demand} = P_{demand} \cdot \tan\varphi
\]
\[
S_{demand} = \frac{P_{demand}}{\cos\varphi}
\]

Единицы: \(P\) — кВт, \(Q\) — квар, \(S\) — кВА.

### 5) Ток (3-фазная сеть)

Для 3-фазной сети:

\[
I_{demand} = \frac{S_{demand}\cdot 1000}{\sqrt{3}\cdot U_{LL}}
\]

где \(U_{LL}\) — `u_ll_v` (В), \(I\) — А.

## Итоги по щиту

Итоговые значения щита в MVP-0.1 — это суммы по строкам:

- \(P_{inst,total} = \sum P_{inst}\)
- \(P_{demand,total} = \sum P_{demand}\)
- \(Q_{demand,total} = \sum Q_{demand}\)
- \(S_{demand,total} = \sum S_{demand}\)

Ток по щиту:

\[
I_{demand,total} = \frac{S_{demand,total}\cdot 1000}{\sqrt{3}\cdot U_{LL}}
\]

## Хранение данных в SQLite

Принцип: **ввод отдельно, расчёт отдельно**.

- Таблица ввода содержит поля ввода (`ne`, `p_nom_kw`, `ki`, `cos_phi`) и GUID.
- Таблица расчёта содержит вычисленные поля (`ki_clamped`, `kr`, `p_inst_kw`, `p_demand_kw`, `q_demand_kvar`, `s_demand_kva`, `i_demand_a`) и GUID.

Конкретные названия таблиц/полей см. `db/migrations/0001_init.sql`.

## Точки расширения (после MVP-0.1)

- Автоматическое вычисление \(n_e\) по составу приёмников.
- Связь с DWG (рендер/аннотации) через отдельный адаптерный слой, не влияющий на `calc_core`.

