# ADR_0001 — Scope MVP-0.1 (SLD-RTM-AutoCAD)

Дата: 2026-02-14  
Статус: Accepted  

## Контекст

Проект "SLD-RTM-AutoCAD" должен считать электрические нагрузки по РТМ 36.18.32.4-92 (форма Ф636-92).
На MVP-0.1 требуется получить рабочий расчёт для **одного щита** с хранением результатов в SQLite и экспортом.

## Решение

- **DB = истина**:
  - Табличные данные `Kr` (РТМ, Таблица 1) хранятся в SQLite (`kr_table`) и используются по жёсткому контракту.
  - Вводные данные и расчётные данные хранятся в **разных таблицах**.
- **Kr контракт неизменяемый**:
  - Clamp `Ki` в диапазон `[0.10, 0.80]`.
  - Выбор `ne_tab` округлением вверх по существующим строкам.
  - Интерполяция только по `Ki` внутри выбранной строки `ne_tab`.
  - Ошибка, если нет подходящей строки/соседей для интерполяции.
  - Контракт описан в `docs/contracts/KR_RESOLVER.md`.
- **Форма Ф636-92 (MVP-интерпретация)**:
  - Для каждой строки (группы приёмников) используются входы: `ne`, `p_nom_kw`, `ki`, `cos_phi`.
  - `Kr` берётся из `kr_table` по `ne` и `ki`.
  - Расчётная активная мощность: \(P_{demand} = P_{inst} \cdot K_i \cdot K_r\).
  - Реактивная/полная мощность и ток считаются по стандартным соотношениям для 3-фазной сети.
  - Подробности описаны в `docs/contracts/RTM_F636.md`.
- **DWG/AutoCAD**:
  - Интеграцию с AutoCAD **не делаем** в MVP-0.1.
  - Архитектурно сохраняем разделение: DWG = рендер, расчёт не зависит от DWG.
- **GUID на уровне сущностей**:
  - Все бизнес-сущности (щит, строки ввода, строки расчёта) имеют GUID (UUID4) как `TEXT`.
- **Миграции обязательны**:
  - Все изменения БД выполняются только через SQL-миграции в `db/migrations/`.

## Альтернативы

- Реализовать интерполяцию по `ne` или выбирать ближайшую строку: отклонено, противоречит контракту.
- Молчаливый fallback при `ne` вне табличного диапазона: отклонено, т.к. скрывает ошибку данных/методики.
- Смешивать ввод и расчёт в одной таблице: отклонено, противоречит требованию разделения.

## Последствия

- Потребуется минимальный “runner” миграций, чтобы создавать/обновлять SQLite в CLI.
- Для корректной работы clamp-тестов seed `kr_table` должен содержать хотя бы крайние `Ki` (`0.10` и `0.80`) для используемых `ne`.

