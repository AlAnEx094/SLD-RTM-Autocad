# DB_ENGINEER TASK — feature/db-layer

ROLE: DB_ENGINEER  
BRANCH: `feature/db-layer` (создать изменения и коммиты только здесь)  
SCOPE (разрешено менять): **только `db/*` SQL файлы**  
SCOPE (запрещено менять): `calc_core/*`, `tools/*`, `tests/*`, `docs/*`, `cad_adapter/*`

## Контекст

В `main` есть baseline (MVP scaffold), но `pytest -q` падает из‑за узкого `db/seed_kr_table.sql`:

- `calc_core.kr_resolver` по контракту clamp’ит `Ki` в `[0.10, 0.80]`.
- Для корректного разрешения `Ki<0.10` нужно, чтобы в `kr_table` существовал столбец `ki=0.10` (как минимум для `ne=4`, который используется в тестах/демо).

Также тест интерполяции должен опираться на минимальные точки (например, между `0.70` и `0.80`).

## Цель

**Минимально** расширить `db/seed_kr_table.sql` **только настолько**, чтобы поддержать contract-тесты `Kr`:

- Добавить точку **`(ne=4, ki=0.10, kr=...)`**
- Сохранить существующие точки `ki=0.60/0.70/0.80` (или эквивалентный минимум)
- НЕ заполнять всю Таблицу 1 РТМ

## Важное правило про значения `Kr`

- **Не притворяться**, что значения взяты из РТМ, если у нас нет источника.
- Если точного значения из РТМ нет под рукой:
  - оставь текущие “примерные” значения как `*_EXAMPLE`
  - добавь **явный TODO-комментарий** в SQL, что значение нужно заменить на табличное из РТМ
  - `source` для новых/сомнительных точек ставь **`RTM_36.18.32.4-92_Table_1_EXAMPLE`** или **`TODO_FILL_FROM_RTM`** (но помни: поле `kr` NOT NULL)

Оркестратор отдельно запросит у пользователя точные числа из РТМ, чтобы заменить EXAMPLE → RTM.

## Deliverables

- Обновить **только**:
  - `db/seed_kr_table.sql`
  - при необходимости (редко): `db/schema.sql` / `db/migrations/0001_init.sql` (только если обнаружишь реальную ошибку схемы)

## Acceptance criteria

- В ветке `feature/db-layer` после изменений:
  - миграция + seed применяются на пустую SQLite без ошибок
  - `kr_table` содержит `ne=4` и `ki=0.10/0.60/0.70/0.80` (минимум для clamp+интерполяции)

## Git workflow (обязательно)

Выполни:

1) `git checkout feature/db-layer`
2) Внести правки только в `db/*`
3) `git add db/seed_kr_table.sql` (и только его, если других DB правок не было)
4) `git commit -m "db: extend minimal kr_table seed for clamp boundary"`

## Проверка

Запусти (для sanity):

- `python3 -c "import sqlite3; ..."` (любой быстрый smoke на применение SQL)

Не запускай/не правь pytest в этой ветке (это задача QA).

